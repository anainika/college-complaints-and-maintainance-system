<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<style>
body{font-family:Arial;background:#f4f6f9;margin:0;padding:0}
header{background:#343a40;color:white;padding:15px;text-align:center}
.container{padding:20px}
table{width:100%;border-collapse:collapse;background:white;border-radius:8px;overflow:hidden}
th,td{padding:10px;border-bottom:1px solid #ddd;text-align:left}
th{background:#e9ecef}
input,select{padding:5px;margin:3px 0}
button{padding:6px 10px;background:#28a745;color:white;border:none;border-radius:4px;cursor:pointer}
img{width:80px;}
</style>
</head>
<body>

<header><h2>Admin Dashboard</h2></header>

<div class="container">
<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Student</th>
            <th>Category</th>
            <th>Location</th>
            <th>Description</th>
            <th>Photo</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody id="complaintsTable"></tbody>
</table>
</div>

<script>
// Check login
if(localStorage.getItem("admin") !== "logged"){
    window.location.href = "admin_login.html";
}

let complaints = JSON.parse(localStorage.getItem("complaints") || "[]");

// Render table
function renderTable(){
    const tbody = document.getElementById("complaintsTable");
    tbody.innerHTML = "";

    complaints.forEach((c, index)=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${c.id}</td>
            <td>${c.name} (${c.studentRoll})</td>
            <td>${c.category}</td>
            <td>${c.location}</td>
            <td>${c.description}</td>
            <td>${c.photo ? `<img src="${c.photo}">` : "No Image"}</td>
            <td>${c.status}</td>
            <td>
                <select id="status-${index}">
                    <option ${c.status==="Pending"?"selected":""}>Pending</option>
                    <option ${c.status==="In Progress"?"selected":""}>In Progress</option>
                    <option ${c.status==="Resolved"?"selected":""}>Resolved</option>
                </select><br>
                <input type="text" id="staff-${index}" placeholder="Assign Staff" value="${c.staff || ""}"><br>
                <input type="text" id="remark-${index}" placeholder="Remark" value="${c.remark || ""}"><br>
                <button onclick="updateComplaint(${index})">Update</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

// Update complaint
function updateComplaint(index){
    const status = document.getElementById(`status-${index}`).value;
    const staff = document.getElementById(`staff-${index}`).value;
    const remark = document.getElementById(`remark-${index}`).value;

    complaints[index].status = status;
    complaints[index].staff = staff;
    complaints[index].remark = remark;

    // Save updated complaints to localStorage
    localStorage.setItem("complaints", JSON.stringify(complaints));

    alert("Complaint updated!");
    renderTable(); // re-render table
}

// Initial render
renderTable();
</script>

</body>
</html>